// Assigned To: PipelineLine
// Type: Constraint
// Name: Limit Material By Asset Type for Pipeline Lines
// Description: Limit values combinations using the fields ASSETGROUP, assettype, material
// Subtypes: All
// Error: 5601
// Error Message: Incompatible types for ASSETGROUP, assettype, material
// Execute: Insert, Update


// ***************************************
// This section has the functions and variables that need to be adjusted based on your implementation

var valid_asset_groups = [1, 2, 3, 4, 5, 6, 7];
if (indexof(valid_asset_groups, $feature.ASSETGROUP) == -1) {
    return true;
}

var feature_fields = [$feature.ASSETGROUP, $feature.assettype, $feature.material];

var valid_values = ['1::1::UN', '1::1::0', '1::1::1', '1::1::2', '1::1::3', '1::1::4', '1::1::5', '1::1::6', '1::1::7', '1::1::8', '1::1::9', '1::1::M', '1::1::N', '1::1::X', '1::1::', '1::2::', '1::2::UN', '1::2::O', '1::2::X', '1::3::UN', '1::3::0', '1::3::1', '1::3::2', '1::3::3', '1::3::4', '1::3::5', '1::3::6', '1::3::7', '1::3::8', '1::3::9', '1::3::M', '1::3::N', '1::3::X', '1::3::', '1::4::T', '1::4::U', '1::4::', '1::4::UN', '1::4::X', '1::4::V', '1::5::X', '1::5::', '1::5::UN', '1::6::S', '1::6::', '1::6::UN', '1::6::X', '1::7::', '1::7::X', '1::7::UN', '1::8::', '1::8::UN', '1::8::X', '1::9::A', '1::9::B', '1::9::C', '1::9::D', '1::9::E', '1::9::F', '1::9::G', '1::9::H', '1::9::UN', '1::9::', '1::9::X', '1::10::J', '1::10::', '1::10::UN', '1::10::X', '1::11::', '1::11::O', '1::11::UN', '1::11::X', '1::12::R', '1::12::', '1::12::UN', '1::12::X', '2::1::UN', '2::1::0', '2::1::1', '2::1::2', '2::1::3', '2::1::4', '2::1::5', '2::1::6', '2::1::7', '2::1::8', '2::1::9', '2::1::M', '2::1::N', '2::1::X', '2::1::', '2::2::', '2::2::UN', '2::2::O', '2::2::X', '2::3::UN', '2::3::0', '2::3::1', '2::3::2', '2::3::3', '2::3::4', '2::3::5', '2::3::6', '2::3::7', '2::3::8', '2::3::9', '2::3::M', '2::3::N', '2::3::X', '2::3::', '2::4::T', '2::4::U', '2::4::', '2::4::UN', '2::4::X', '2::4::V', '2::5::X', '2::5::', '2::5::UN', '2::6::S', '2::6::', '2::6::UN', '2::6::X', '2::7::', '2::7::X', '2::7::UN', '2::8::', '2::8::UN', '2::8::X', '2::9::A', '2::9::B', '2::9::C', '2::9::D', '2::9::E', '2::9::F', '2::9::G', '2::9::H', '2::9::UN', '2::9::', '2::9::X', '2::10::J', '2::10::', '2::10::UN', '2::10::X', '2::11::', '2::11::O', '2::11::UN', '2::11::X', '2::12::R', '2::12::', '2::12::UN', '2::12::X', '3::1::UN', '3::1::0', '3::1::1', '3::1::2', '3::1::3', '3::1::4', '3::1::5', '3::1::6', '3::1::7', '3::1::8', '3::1::9', '3::1::M', '3::1::N', '3::1::X', '3::1::', '3::2::', '3::2::UN', '3::2::O', '3::2::X', '3::3::UN', '3::3::0', '3::3::1', '3::3::2', '3::3::3', '3::3::4', '3::3::5', '3::3::6', '3::3::7', '3::3::8', '3::3::9', '3::3::M', '3::3::N', '3::3::X', '3::3::', '3::4::T', '3::4::U', '3::4::', '3::4::UN', '3::4::X', '3::4::V', '3::6::S', '3::6::', '3::6::UN', '3::6::X', '3::11::', '3::11::O', '3::11::UN', '3::11::X', '3::12::R', '3::12::', '3::12::UN', '3::12::X', '4::1::UN', '4::1::0', '4::1::1', '4::1::2', '4::1::3', '4::1::4', '4::1::5', '4::1::6', '4::1::7', '4::1::8', '4::1::9', '4::1::M', '4::1::N', '4::1::X', '4::1::', '4::2::', '4::2::UN', '4::2::O', '4::2::X', '4::3::UN', '4::3::0', '4::3::1', '4::3::2', '4::3::3', '4::3::4', '4::3::5', '4::3::6', '4::3::7', '4::3::8', '4::3::9', '4::3::M', '4::3::N', '4::3::X', '4::3::', '4::4::T', '4::4::U', '4::4::', '4::4::UN', '4::4::X', '4::4::V', '4::6::S', '4::6::', '4::6::UN', '4::6::X', '4::7::', '4::7::X', '4::7::UN', '4::8::', '4::8::UN', '4::8::X', '4::9::A', '4::9::B', '4::9::C', '4::9::D', '4::9::E', '4::9::F', '4::9::G', '4::9::H', '4::9::UN', '4::9::', '4::9::X', '4::10::J', '4::10::', '4::10::UN', '4::10::X', '4::11::', '4::11::O', '4::11::UN', '4::11::X', '4::12::R', '4::12::', '4::12::UN', '4::12::X', '5::1::UN', '5::1::0', '5::1::1', '5::1::2', '5::1::3', '5::1::4', '5::1::5', '5::1::6', '5::1::7', '5::1::8', '5::1::9', '5::1::M', '5::1::N', '5::1::X', '5::1::', '5::2::', '5::2::UN', '5::2::O', '5::2::X', '5::3::UN', '5::3::0', '5::3::1', '5::3::2', '5::3::3', '5::3::4', '5::3::5', '5::3::6', '5::3::7', '5::3::8', '5::3::9', '5::3::M', '5::3::N', '5::3::X', '5::3::', '5::4::T', '5::4::U', '5::4::', '5::4::UN', '5::4::X', '5::4::V', '5::6::S', '5::6::', '5::6::UN', '5::6::X', '5::11::', '5::11::O', '5::11::UN', '5::11::X', '5::12::R', '5::12::', '5::12::UN', '5::12::X', '7::1::UN', '7::1::0', '7::1::1', '7::1::2', '7::1::3', '7::1::4', '7::1::5', '7::1::6', '7::1::7', '7::1::8', '7::1::9', '7::1::M', '7::1::N', '7::1::X', '7::1::', '7::2::', '7::2::UN', '7::2::O', '7::2::X', '7::3::UN', '7::3::0', '7::3::1', '7::3::2', '7::3::3', '7::3::4', '7::3::5', '7::3::6', '7::3::7', '7::3::8', '7::3::9', '7::3::M', '7::3::N', '7::3::X', '7::3::', '7::4::', '7::4::UN', '7::4::X', '7::6::S', '7::6::', '7::6::UN', '7::6::X', '7::11::', '7::11::O', '7::11::UN', '7::11::X', '7::12::R', '7::12::', '7::12::UN', '7::12::X', '6::1::UN', '6::1::0', '6::1::1', '6::1::2', '6::1::3', '6::1::4', '6::1::5', '6::1::6', '6::1::7', '6::1::8', '6::1::9', '6::1::M', '6::1::N', '6::1::X', '6::1::', '6::2::', '6::2::UN', '6::2::O', '6::2::X', '6::3::UN', '6::3::0', '6::3::1', '6::3::2', '6::3::3', '6::3::4', '6::3::5', '6::3::6', '6::3::7', '6::3::8', '6::3::9', '6::3::M', '6::3::N', '6::3::X', '6::3::', '6::4::T', '6::4::U', '6::4::', '6::4::UN', '6::4::X', '6::4::V', '6::6::S', '6::6::', '6::6::UN', '6::6::X', '6::7::', '6::7::X', '6::7::UN', '6::8::', '6::8::UN', '6::8::X', '6::9::A', '6::9::B', '6::9::C', '6::9::D', '6::9::E', '6::9::F', '6::9::G', '6::9::H', '6::9::UN', '6::9::', '6::9::X', '6::10::J', '6::10::', '6::10::UN', '6::10::X', '6::11::', '6::11::O', '6::11::UN', '6::11::X', '6::12::R', '6::12::', '6::12::UN', '6::12::X'];

// ************* End Section *****************
function splice(arr, start, end) {
    var new_arr = [];
    var k = 0;
    for (var i = start; i < end; i++) {
        new_arr[k++] = arr[i];
    }
    return new_arr;
}

function join_array(a, b) {
    var new_arr = [];
    var k = 0;
    for (var i in a) {
        new_arr[k++] = a[i];
    }
    for (var i in b) {
        new_arr[k++] = b[i];
    }
    return new_arr;
}
var feature_values = [Concatenate(feature_fields, '::')];
var any_sent = '|ANY|';
var fld_count = Count(feature_fields);
for (var i = 0; i < fld_count; i++) {
    var start_arr = splice(feature_fields, 0, i)
    start_arr[Count(start_arr)] = any_sent;
    var end_arr = splice(feature_fields, i + 1, fld_count)
    feature_values[i + 1] = Concatenate(join_array(start_arr, end_arr), '::')

}
var match_found = false;
for (var i = 0; i < Count(feature_values); i++){
    if (IndexOf(valid_values, feature_values[i]) > -1) {
        match_found = true;
        break;
    }
}
if (match_found == false) {
    return {"errorMessage": "The selected attributes for ASSETGROUP, assettype, material are not valid."}
}
return true;